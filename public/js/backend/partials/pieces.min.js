
$(document).ready(function(){$("#pieces-list").ready(function(){$(this).loadPieces(false)});$("#add-form").on("submit",(function(a){a.preventDefault();$.ajax({url:$("#add-form").action,data:new FormData(this),type:"POST",contentType:false,cache:false,processData:false,success:function(b){if(b.input!==""){$("#add-form "+b.input).css("border","1px solid #F00")}else{$("#add-form input").css("border","1px solid #6C8B81");$("#add-form").trigger("reset");$("#pieces-list").loadPieces(true)}alert(b.message)},error:function(){alert("Imposible registrar nuevas piezas en estos momentos. Inténtenlo de nuevo más tarde.")}})}));$("#edit-delete-form").on("submit",(function(c){c.preventDefault();var d=$("#piece-id").val();var a=$("#edit-delete-form").attr("action").replace(":PIECE_ID",d);var b=$("#edit-delete-form").data("pieceName");$.ajax({url:a,data:new FormData(this),type:"POST",contentType:false,cache:false,processData:false,success:function(e){if(e.input!==""){$("#edit-delete-form "+e.input).css("border","1px solid #F00")}else{$("#edit-delete-form input").css("border","1px solid #6C8B81");$("#edit-delete-form").trigger("reset");$("#pieces-list").loadPieces(false);$("#forms").clickAddTab()}alert(e.message)},error:function(){alert('Imposible editar la pieza "'+b+'" seleccionada en estos momentos. Inténtenlo de nuevo más tarde.')}})}));$("#pieces-list").click(function(b){var c=$(b.target).parent().attr("id");$("#edit-delete-form").data("pieceName",c);var a="#"+c;if(c!=="list"){$(".thumbnail").css({"box-shadow":"none",border:"1px solid #DDD"});$(".thumbnail img").css({opacity:"1"});$(a).css({"box-shadow":"0 0 10px #000",border:"1px solid #000"});$(a+" img").css({opacity:"0.50"})}var d=$(a).parent().attr("id");if(d==="pieces-list"){b.preventDefault();$.get("/admin/piezas/"+c,function(e){$("#forms").clickEditDeleteTab();$("#edit-delete-form #name").val(e.name);$("#edit-delete-form #piece-id").val(e.id);$("#edit-delete-form #upload-file").val(uploadDir+"/"+e.image);$("#chosen-img").attr("src",uploadDir+"/"+e.image+"?"+Math.random())}).fail(function(){alert("Imposible obtener los datos de la pieza seleccionada en estos momentos")})}});$("#delete-btn").click(function(){var c=$("#piece-id").val();var a=$("#delete-form").attr("action").replace(":PIECE_ID",c);var b=$("#edit-delete-form").data("pieceName");if(confirm('¿Está seguro de que quiere eliminar la pieza "'+b+'"?')){$.post(a,$("#delete-form").serialize(),function(d){alert(d);$("#edit-delete-form").trigger("reset");$("#delete-form").trigger("reset");$("#edit-btn").attr("disabled",true);$("#delete-btn").attr("disabled",true);$("#edit-delete-form #upload-btn").attr("disabled",true);$("#pieces-list").fadeOut("slow",function(){$("#pieces-list").loadPieces(false)})}).fail(function(){alert('Imposible eliminar la pieza "'+b+'" seleccionada en estos momentos. Inténtenlo de nuevo más tarde.')})}});$("#edit-delete-form #cancel-btn").click(function(){$("#add-form").trigger("reset");$("#edit-delete-form").trigger("reset");$("#chosen-img").remove();$("#forms").clickAddTab()});$.fn.loadPieces=function(a){$.get("/admin/piezas/listar",function(f){var d=f.length;var e;var c="";var b;$("#pieces-list").fadeOut("slow",function(){if(d>0){var g=0;for(g=0;g<d;g++){e=f[g];b='<a title="Pieza '+e.name+'" href="#!" class="thumbnail" id="'+e.name+'"><img title="Pieza '+e.name+'" src="/_data/piezas/'+e.image+"?"+Math.random()+'" alt="Pieza '+e.name+'" width="105" height="105" /><span>'+e.name+"</span></a>";c+=b}$("#pieces-list").html(c);if(a){var h="#"+e.name;$(location).attr("href",h)}}else{$("#pieces-list").html('<h3 class="alert alert-danger text-center">Aún no hay piezas registradas<br /><small class="alert-danger">Añada piezas para poder visualizarlas aquí</small><h3>')}$("#pieces-list").fadeIn("slow")})}).fail(function(){alert("Imposible obtener la lista de piezas en estos momentos")})}});