
$(document).ready(function(){$("#plaques-list").ready(function(){$(this).loadPlaques(false)});$("[data-toggle=tab]").click(function(a){if(this.id=="add-tab"){$("#edit-delete-form").trigger("reset");$(".add-tab").clickAddTabPlaque(false);$(".thumbnail").css({"box-shadow":"none",border:"1px solid #DDD"});$(".thumbnail img").css({opacity:"1"});$("#edit-delete-tab a").attr("href","#!")}else{$("#add-form").trigger("reset");$(".edit-delete-tab").clickEditDeleteTabPlaque(false)}$(".nodes").data("cont",0)});$(".add-pieces .add-list").ready(function(){$(this).loadPieces("add");$(".add-colours").loadColours("add");$(".nodes").data("cont",0)});$(".list").on("click","a",function(d){var a=$(".nodes").data("cont")+1;var c="#edit-delete-form .nodes";var f=$(d.target).parent();if($(f).parent().hasClass("add-list")){c="#add-form .nodes"}var b=$(".nodes").appendPieces("add",this.id,a,null);$(c).append(b);$(".nodes").data("cont",a);$(".nodes").data("current",a)});$(".colours").on("click","a",function(h){var g="#"+this.id;var b=$(g).attr("title");var a=$(g+" img").attr("src");var f="#edit-delete-form";var i=$(h.target).parent();if($(i).parent().hasClass("add-colours")){f="#add-form"}var c=f+" #piece_"+$(".nodes").data("current")+"_colour_img";var d=f+" #piece_"+$(".nodes").data("current")+"_colour";$(c).attr("src",a);$(c).attr("title",b);$(c).attr("alt",b);$(d).val(this.id)});$(".nodes").on("click",".thumb",function(){var a=this.id.replace("thumb_","");$(".nodes").data("current",a)});$(".nodes").on("click","button",function(){if(this.id.search("_delete")!=-1){var a="#"+this.id.replace("_delete","_info");$(a).remove(a)}else{var c="#"+this.id.replace("_lock","_locked");var b="#"+this.id;if($(c).val()==0){$(c).val(1);$(b).removeClass("btn-primary");$(b).addClass("btn-warning")}else{$(c).val(0);$(b).removeClass("btn-warning");$(b).addClass("btn-primary")}}});$("#add-form").on("submit",(function(b){b.preventDefault();var a=$(".nodes").data("cont");$("#add-form #pieces").val(a);$.ajax({url:$("#add-form").action,data:new FormData(this),type:"POST",contentType:false,cache:false,processData:false,success:function(d){if(d.input!=""){var e=d.input.split(",");for(var c=0;c<e.length;c++){$("#add-form "+e[c]).css("border","1px solid #F00")}}else{$("#add-form input").css("border","1px solid #6C8B81");$("#add-form .nodes").empty();$("#plaques-list").loadPlaques(true);$("#add-form").trigger("reset")}alert(d.message)},error:function(){alert("Imposible registrar nuevas placas en estos momentos. Inténtenlo de nuevo más tarde.")}})}));$("#edit-delete-form #cancel-btn").click(function(){$("#add-form .nodes").empty();$("#add-form").trigger("reset");$("#edit-delete-form").trigger("reset");$("#edit-delete-form .nodes").empty();$("#chosen-img").remove();$("#forms").clickAddTabPlaque(true)});$("#edit-delete-form").on("submit",(function(d){d.preventDefault();var a=$(".nodes").data("cont");$("#edit-delete-form #pieces").val(a);var b=$("#plaque-id").val();var c=$("#edit-delete-form").attr("action").replace(":PLAQUE_ID",b);var f=$("#edit-delete-form").data("plaqueName");$.ajax({url:c,data:new FormData(this),type:"POST",contentType:false,cache:false,processData:false,success:function(g){if(g.input!=""){var h=g.input.split(",");for(var e=0;e<h.length;e++){$("#edit-delete-form "+h[e]).css("border","1px solid #F00")}}else{$("#edit-delete-form input").css("border","1px solid #6C8B81");$("#plaques-list").loadPlaques(false);$("#edit-delete-form").trigger("reset");$("#edit-delete-form .nodes").empty();$("#chosen-img").remove();$("#forms").clickAddTabPlaque(true)}alert(g.message)},error:function(){alert('Imposible editar la placa "'+f+'" seleccionada en estos momentos. Inténtenlo de nuevo más tarde.')}})}));$("#plaques-list").click(function(c){$(".edit-delete-pieces").loadPieces("edit-delete");$(".edit-delete-colours").loadColours("edit-delete");$(".nodes").resetNodes();var b=$(c.target).parent().attr("id");$("#edit-delete-form").data("plaqueName",b);var a="#"+b;if(b!="list"){$(a).markup(a)}var d=$(a).parent().attr("id");if(d=="plaques-list"){c.preventDefault();$.get("/admin/placas/"+b,function(e){$("#forms").clickEditDeleteTabPlaque(true);$("#edit-delete-form").loadPlaque(e)}).fail(function(){alert("Imposible obtener los datos de la placa seleccionada")})}});$("#delete-btn").click(function(){var a=$("#plaque-id").val();var b=$("#delete-form").attr("action").replace(":PLAQUE_ID",a);var c=$("#edit-delete-form").data("plaqueName");if(confirm('¿Está seguro de que quiere eliminar la placa "'+c+'"?')){$.post(b,$("#delete-form").serialize(),function(d){alert(d);$("#edit-delete-form").trigger("reset");$("#delete-form").trigger("reset");$("#edit-btn").attr("disabled",true);$("#delete-btn").attr("disabled",true);$("#edit-delete-form #upload-btn").attr("disabled",true);$("#forms").clickAddTabPlaque(true);$("#plaques-list").fadeOut("slow",function(){$("#plaques-list").loadPlaques(false)})}).fail(function(){alert('Imposible eliminar la placa "'+c+'" seleccionada en estos momentos. Inténtenlo de nuevo más tarde.')})}});$.fn.loadPlaque=function(d){$("#edit-delete-form #name").val(d.name);$("#edit-delete-form #format").val(d.format);$("#edit-delete-form #plaque-id").val(d.id);$("#edit-delete-form #upload-file").val(uploadDir+"/"+d.thumbnail);$("#chosen-img").attr("src",uploadDir+"/"+d.thumbnail+"?"+Math.random());$("#edit-delete-form").data("plaqueName",d.name);var a=0;if(d.piecesList!=null){var c=d.piecesList.length;var e;var b="";for(a=0;a<c;a++){e=d.piecesList[a];b=$("#edit-delete-form .nodes").appendPieces("edit-delete",e.id,a+1,e);$("#edit-delete-form .nodes").append(b)}$(".nodes").data("cont",a+1)}};$.fn.markup=function(a){$(".thumbnail").css({"box-shadow":"none",border:"1px solid #DDD"});$(".thumbnail img").css({opacity:"1"});$(a).css({"box-shadow":"0 0 10px #000",border:"1px solid #000"});$(a+" img").css({opacity:"0.50"})};$.fn.appendPieces=function(e,h,b,d){var g="#"+h;var f=$(g).attr("title");var a=$(g+" img").attr("src");var c="";c='<span id="piece_'+b+'_info"><img title="Click para seleccionar '+f+'" src="'+a+'" alt="'+f+'" class="thumb" id="thumb_'+b+'" data-toggle="tooltip" data-placement="left" /> en ';if(e=="add"){c+='<img title="Sin color" src="" alt="??" id="piece_'+b+'_colour_img" />: ';c+='<button type="button" name="Eliminar pieza '+f+'" id="piece_'+b+'_delete" class="button btn-danger" data-toggle="tooltip" data-placement="right" title="Click para eliminar"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></button>';c+='<button type="button" name="Bloquear pieza '+f+'" id="piece_'+b+'_lock" class="button btn-primary" data-toggle="tooltip" data-placement="right" title="Click para bloquear/desbloquear"><span class="glyphicon glyphicon-lock" aria-hidden="true"></span></button>';c+='<input type="text" id="piece_'+b+'_nodes" name="piece_'+b+'_nodes" class="form-control" placeholder="Nodos del trazado de la pieza..." required />';c+='<input type="hidden" name="piece_'+b+'_colour" id="piece_'+b+'_colour" value="" />';c+='<input type="hidden" name="piece_'+b+'_locked" id="piece_'+b+'_locked" value="0" />'}else{c+='<img title="'+d.colour+'" src="/_data/colores/'+d.colour+'.jpg" alt="'+d.colour+'" id="piece_'+b+'_colour_img" />: ';c+='<button type="button" name="Eliminar pieza '+f+'" id="piece_'+b+'_delete" class="button btn-danger" data-toggle="tooltip" data-placement="right" title="Click para eliminar"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></button>';if(d.isLocked==0){c+='<button type="button" name="Bloquear pieza '+f+'" id="piece_'+b+'_lock" class="button btn-primary" data-toggle="tooltip" data-placement="right" title="Click para bloquear/desbloquear"><span class="glyphicon glyphicon-lock" aria-hidden="true"></span></button>'}else{c+='<button type="button" name="Bloquear pieza '+f+'" id="piece_'+b+'_lock" class="button btn-warning" data-toggle="tooltip" data-placement="right" title="Click para bloquear/desbloquear"><span class="glyphicon glyphicon-lock" aria-hidden="true"></span></button>'}c+='<input type="text" id="piece_'+b+'_nodes" name="piece_'+b+'_nodes" value="'+d.nodes+'" class="form-control" placeholder="Nodos del trazado de la pieza..." required />';c+='<input type="hidden" name="piece_'+b+'_colour" id="piece_'+b+'_colour" value="'+d.colour+'" />';c+='<input type="hidden" name="piece_'+b+'_locked" id="piece_'+b+'_locked" value="'+d.isLocked+'" />'}c+='<input type="hidden" name="piece_'+b+'_id" id="piece_'+b+'_id" value="'+h+'" /></span>';return c};$.fn.resetNodes=function(){$(".nodes").empty();$(".nodes").removeData();$(".nodes").data("cont",0)};$.fn.clickEditDeleteTabPlaque=function(a){$("#edit-delete-tab").attr("role","presentation");$("#edit-delete-tab").attr("aria-controls","edit-delete-tab");$("#edit-delete-tab").attr("data-toggle","tab");$("#edit-delete-tab a").attr("href","#tab-edit-delete-form");$("#edit-delete-tab").removeClass("disabled");if(a){$("#edit-delete-tab").trigger("click")}$("#tab-add-form").removeClass("active");$("#tab-edit-delete-form").addClass("active");$("#edit-btn").removeAttr("disabled");$("#delete-btn").removeAttr("disabled");$("#edit-delete-form #upload-btn").removeAttr("disabled");$("#edit-delete-form #upload-btn").removeAttr("required")};$.fn.clickAddTabPlaque=function(a){$("#edit-delete-tab").removeAttr("role","presentation");$("#edit-delete-tab").removeAttr("aria-controls","edit-delete-tab");$("#edit-delete-tab").removeAttr("data-toggle","tab");$("#edit-delete-tab a").removeAttr("href","#tab-edit-delete-form");$("#edit-delete-tab").addClass("disabled");if(a){$("#add-tab").trigger("click")}$("#tab-add-form").addClass("active");$("#tab-edit-delete-form").removeClass("active");$("#edit-btn").attr("disabled");$("#delete-btn").attr("disabled");$("#edit-delete-form #upload-btn").attr("disabled");$("#edit-delete-form #upload-btn").attr("required")};$.fn.loadPlaques=function(a){$.get("/admin/placas/listar",function(f){var e=f.length;var d;var c="";var b;$("#plaques-list").fadeOut("slow",function(){if(e>0){var g=0;for(g=0;g<e;g++){d=f[g];b='<a title="Placa '+d.name+'" href="#!" class="thumbnail" id="'+d.id+'"><img title="Placa '+d.name+'" src="/_data/placas/'+d.thumbnail+"?"+Math.random()+'" alt="Placa '+d.name+'" width="105" height="105" /><span>'+d.name+"</span></a>";c+=b}$("#plaques-list").html(c);if(a){var h="#"+d.id;$(location).attr("href",h)}}else{$("#plaques-list").html('<h3 class="alert alert-danger text-center">Aún no hay placas registradas<br /><small class="alert-danger">Añada placas para poder visualizarlas aquí</small><h3>')}$("#plaques-list").fadeIn("slow")})}).fail(function(){alert("Imposible obtener la lista de placas en estos momentos")})};$.fn.loadPieces=function(a){$.get("/admin/piezas/listar",function(h){var f=h.length;var g;var e="";var d;var c="#"+a+"-form ."+a+"-list";if(f>0){var b=0;for(b=0;b<f;b++){g=h[b];d='<a title="Click para añadir pieza '+g.name+'" href="#!" class="thumbnail" id="'+g.id+'" data-toggle="tooltip" data-placement="top"><img title="Pieza '+g.name+'" src="/_data/piezas/'+g.image+'" alt="Pieza '+g.name+'" width="105" height="105" /><span>'+g.name+"</span></a>";e+=d}$(c).html(e)}else{$(c).html('<h3 class="alert alert-danger text-center">Aún no hay piezas registradas<br /><small class="alert-danger">Añada piezas para poder visualizarlas aquí</small><h3>')}}).fail(function(){alert("Imposible obtener la lista de piezas en estos momentos")})};$.fn.loadColours=function(a){$.get("/admin/colores/listar",function(h){var f=h.length;var g;var e="";var d;var c="#"+a+"-form ."+a+"-colours";if(f>0){var b=0;for(b=0;b<f;b++){g=h[b];d='<a title="Asignar color '+g.name+'" href="#!" class="thumbnail" id="'+g.name+'" data-toggle="tooltip" data-placement="top"><img title="Color '+g.name+'" src="/_data/colores/'+g.image+'" alt="Color '+g.name+'" width="105" height="105" /><span>'+g.name+"</span></a>";e+=d}$(c).html(e)}else{$(c).html('<h3 class="alert alert-danger text-center">Aún no hay colores registrados<br /><small class="alert-danger">Añada colores a la paleta para poder visualizarlos aquí</small><h3>')}}).fail(function(){alert("Imposible obtener la lista de colores en estos momentos")})}});