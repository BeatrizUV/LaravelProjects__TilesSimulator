
$(document).ready(function(){$("#colours-list").ready(function(){$(this).loadColours(false)});$("#add-form").on("submit",(function(a){a.preventDefault();$.ajax({url:$("#add-form").action,data:new FormData(this),type:"POST",contentType:false,cache:false,processData:false,success:function(b){if(b.input!==""){$("#add-form "+b.input).css("border","1px solid #F00")}else{$("#add-form input").css("border","1px solid #6C8B81");$("#add-form").trigger("reset");$("#colours-list").loadColours(true)}alert(b.message)},error:function(){alert("Imposible registrar nuevos colores en estos momentos. Inténtenlo de nuevo más tarde.")}})}));$("#edit-delete-form").on("submit",(function(d){d.preventDefault();var c=$("#colour-id").val();var b=$("#edit-delete-form").attr("action").replace(":COLOUR_ID",c);var a=$("#edit-delete-form").data("colourName");$.ajax({url:b,data:new FormData(this),type:"POST",contentType:false,cache:false,processData:false,success:function(e){if(e.input!==""){$("#edit-delete-form "+e.input).css("border","1px solid #F00")}else{$("#edit-delete-form input").css("border","1px solid #6C8B81");$("#edit-delete-form").trigger("reset");$("#forms").clickAddTab();$("#colours-list").loadColours(false)}alert(e.message)},error:function(){alert('Imposible editar el color "'+a+'" seleccionado en estos momentos. Inténtenlo de nuevo más tarde.')}})}));$("#colours-list").click(function(c){var b=$(c.target).parent().attr("id");$("#edit-delete-form").data("colourName",b);var a="#"+b;if(b!=="list"){$(".thumbnail").css({"box-shadow":"none",border:"1px solid #DDD"});$(".thumbnail img").css({opacity:"1"});$(a).css({"box-shadow":"0 0 10px #000",border:"1px solid #000"});$(a+" img").css({opacity:"0.50"})}var d=$(a).parent().attr("id");if(d==="colours-list"){c.preventDefault();$.get("/admin/colores/"+b,function(e){$("#forms").clickEditDeleteTab();$("#edit-delete-form #name").val(e.name);$("#edit-delete-form #colour-id").val(e.id);$("#edit-delete-form #upload-file").val(uploadDir+"/"+e.image);$("#chosen-img").attr("src",uploadDir+"/"+e.image+"?"+Math.random())}).fail(function(){alert("Imposible obtener los datos del color seleccionado en estos momentos")})}});$("#delete-btn").click(function(){var c=$("#colour-id").val();var b=$("#delete-form").attr("action").replace(":COLOUR_ID",c);var a=$("#edit-delete-form").data("colourName");if(confirm('¿Está seguro de que quiere eliminar el color "'+a+'"?')){$.post(b,$("#delete-form").serialize(),function(d){alert(d);$("#edit-delete-form").trigger("reset");$("#delete-form").trigger("reset");$("#edit-btn").attr("disabled",true);$("#delete-btn").attr("disabled",true);$("#edit-delete-form #upload-btn").attr("disabled",true);$("#colours-list").fadeOut("slow",function(){$("#colours-list").loadColours(false)})}).fail(function(){alert('Imposible eliminar el color "'+a+'" seleccionado en estos momentos. Inténtenlo de nuevo más tarde.')})}});$("#edit-delete-form #cancel-btn").click(function(){$("#add-form").trigger("reset");$("#edit-delete-form").trigger("reset");$("#chosen-img").remove();$("#forms").clickAddTab()});$.fn.loadColours=function(a){$.get("/admin/colores/listar",function(f){var d=f.length;var e;var c="";var b;$("#colours-list").fadeOut("slow",function(){if(d>0){var g=0;for(g=0;g<d;g++){e=f[g];b='<a title="Color '+e.name+'" href="#!" class="thumbnail" id="'+e.name+'"><img title="Color '+e.name+'" src="/_data/colores/'+e.image+"?"+Math.random()+'" alt="Color '+e.name+'" width="105" height="105" /><span>'+e.name+"</span></a>";c+=b}$("#colours-list").html(c);if(a){var h="#"+e.name;$(location).attr("href",h)}}else{$("#colours-list").html('<h3 class="alert alert-danger text-center">Aún no hay colores registrados<br /><small class="alert-danger">Añada colores a la paleta para poder visualizarlos aquí</small><h3>')}$("#colours-list").fadeIn("slow")})}).fail(function(){alert("Imposible obtener la lista de colores en estos momentos")})}});