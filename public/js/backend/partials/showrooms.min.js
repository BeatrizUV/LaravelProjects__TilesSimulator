
$(document).ready(function(){$("#showrooms-list").ready(function(){$(this).loadShowrooms(false)});$("#add-form").on("submit",(function(a){a.preventDefault();$.ajax({url:$("#add-form").action,data:new FormData(this),type:"POST",contentType:false,cache:false,processData:false,success:function(c){if(c.input!==""){var d=c.input.split(",");for(var b=0;b<d.length;b++){$("#add-form "+d[b]).css("border","1px solid #F00")}}else{$("#add-form input").css("border","1px solid #6C8B81");$("#showrooms-list").loadShowrooms(true);$("#add-form").trigger("reset")}alert(c.message)},error:function(){alert("Imposible registrar nuevos distribuidores en estos momentos. Inténtenlo de nuevo más tarde.")}})}));$("#edit-delete-form").on("submit",(function(d){d.preventDefault();var a=$("#showroom-id").val();var c=$("#edit-delete-form").attr("action").replace(":SHOWROOM_ID",a);var b=$("#edit-delete-form").data("showroomName");$.ajax({url:c,data:new FormData(this),type:"POST",contentType:false,cache:false,processData:false,success:function(f){if(f.input!==""){var g=f.input.split(",");for(var e=0;e<g.length;e++){$("#edit-delete-form "+g[e]).css("border","1px solid #F00")}}else{$("#edit-delete-form input").css("border","1px solid #6C8B81");$("#showrooms-list").loadShowrooms(false);$("#edit-delete-form").trigger("reset");$("#forms").clickAddTab()}alert(f.message)},error:function(){alert('Imposible editar la pieza "'+b+'" seleccionada en estos momentos. Inténtenlo de nuevo más tarde.')}})}));$("#showrooms-list").on("click","table > tbody > tr",function(){var b=$(this).attr("id");var a="#"+b;$("table tbody tr").removeClass("alert btn-warning");$(a).addClass("alert btn-warning");$(a).css("color","#333");$.get("/admin/distribuidores/"+b,function(c){$("#forms").clickEditDeleteTab();$("#edit-delete-form").data("showroomName",c.company);$("#edit-delete-form #company").val(c.company);$("#edit-delete-form #email").val(c.email);$("#edit-delete-form #telephone").val(c.telephone);$("#edit-delete-form #website").val(c.website);$("#edit-delete-form #lang").val(c.lang).prop("selected",true);$("#edit-delete-form #upload-file").val(uploadDir+"/"+c.logo);$("#chosen-img").attr("src",uploadDir+"/"+c.logo+"?"+Math.random());$("#edit-delete-form #showroom-id").val(c.id)}).fail(function(){alert("Imposible obtener los datos del distribuidor seleccionado")})});$("#delete-btn").click(function(){var a=$("#showroom-id").val();var c=$("#delete-form").attr("action").replace(":SHOWROOM_ID",a);var b=$("#edit-delete-form").data("showroomName");if(confirm('¿Está seguro de que quiere eliminar el distribuidor "'+b+'"?')){$.post(c,$("#delete-form").serialize(),function(d){alert(d);$("#edit-delete-form").trigger("reset");$("#delete-form").trigger("reset");$("#edit-btn").attr("disabled",true);$("#delete-btn").attr("disabled",true);$("#edit-delete-form #upload-btn").attr("disabled",true);$("#showrooms-list").fadeOut("slow",function(){$("#showrooms-list").loadShowrooms(false)})}).fail(function(){alert('Imposible eliminar el distribuidor "'+b+'" seleccionada en estos momentos. Inténtenlo de nuevo más tarde.')})}});$("#edit-delete-form #cancel-btn").click(function(){$("#add-form").trigger("reset");$("#edit-delete-form").trigger("reset");$("#chosen-img").remove();$("#forms").clickAddTab()});$.fn.loadShowrooms=function(a){$.get("/admin/distribuidores/listar",function(b){var d=b.length;var f;var c="";var e;$("#showrooms-list").fadeOut("slow",function(){if(d>0){var g=0;c+='<table class="table table-condensed table-bordered szd-table-shadow"><thead><tr class="alert-success"><th>LOGOTIPO</th><th>EMPRESA</th><th>DATOS DE CONTACTO</th><th>IDIOMA</th></tr></thead><tbody>';for(g=0;g<d;g++){f=b[g];e='<tr id="'+f.id+'">\n                                            <td><img title="Distribuidor '+f.company+'" src="/_data/distribuidores/'+f.logo+"?"+Math.random()+'" alt="Distribuidor '+f.company+'" width="50" height="50" /></td>\n                                            <td>'+f.company+"</td>\n                                            <td>"+f.telephone+"<br />"+f.email+"<br />"+f.website+'</td>\n                                            <td><img title="'+f.lang+'" src="/images/lang/'+f.lang+'.png" alt="'+f.lang+'" width="25" height="15" /></td>\n                                       </tr>';c+=e}c+="</tbody></table>";$("#showrooms-list").html(c);if(a){var h="#"+f.id;$(location).attr("href",h)}}else{$("#showrooms-list").html('<h3 class="alert alert-danger text-center">Aún no hay distribuidores registrados<br /><small class="alert-danger">Añada distribuidores para poder visualizarlos aquí</small><h3>')}$("#showrooms-list").fadeIn("slow")})}).fail(function(){alert("Imposible obtener la lista de distribuidores")})}});