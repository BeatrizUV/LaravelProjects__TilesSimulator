
$(document).ready(function(){$(function(){$("body").tooltip({selector:"[data-toggle=tooltip]"});$("#budget").modal("hide");$(".szd-budget-btn").css("pointer-events","all");$("#colorizer").height("456px");$("#colorizer").width("456px");$(".szd-preview div").height($(".szd-preview div").width());$("body").data("random",Math.random());$("#mosaic-right").data("flippedSVG",[28,32]);$("#cookies-alert").checkCookies()});$("body").bind("contextmenu",function(a){a.preventDefault();return false});$("#colours-palette").ready(function(){$(this).loadColours()});$("#plaques-carousel").ready(function(){$(this).loadPlaques()});$("#colours-palette").on("click","div",function(){$("#selected-colour").removeClass($("#selected-colour").data("currentColour"));$("#selected-colour").addClass(this.id);$("#selected-colour").data("currentColour",this.id);$("#selected-colour").attr("title",this.id);$("#selected-colour").attr("data-toggle","tooltip");$("#selected-colour").attr("data-placement","left");$("#colorizer").addClass("szd-cursor-paint-bucket")});$("#plaques-carousel").on("click","img",function(){$("#colorizer").waiting("colorizer");$(".szd-preview").waiting("mosaic");$("#plaques-carousel").markup(this.id);$("#colorizer").loadPlaque(this.id);$(".szd-budget-btn").attr("data-toggle","modal");$(".szd-budget-btn").attr("data-target","#budget");$(".szd-budget-btn").removeClass("disabled");$(".szd-budget-btn").css("cursor","pointer")});$("#carousel-up").click(function(){var c=110;var b=0;var d=parseInt($("#first").css("margin-top").replace("px",""));var a=(d+c)+"px";if(d<b){$("#first").animate({"margin-top":a},250,"linear")}});$("#carousel-down").click(function(){var d=110;var h=4;var e=$("#plaques-carousel").data("plaques");var a=d*e;var g=d*h;var c=(a-g)*-1;var f=parseInt($("#first").css("margin-top").replace("px",""));var b=(f-d)+"px";if(f>c){$("#first").animate({"margin-top":b},250,"linear")}});$(".szd-reset-btn").click(function(){$("#colorizer").empty();$("#colorizer").css("background-color","#EBEBEB");$("#selected-colour").removeClass($("#selected-colour").data("currentColour"));$("#colorizer").removeData("currentPlaque");$("#colorizer").removeData("currentColour");$("#mosaic-left").empty();$("#mosaic-right").empty();$("#mosaic-left").css("background-color","#EBEBEB");$("#mosaic-right").css("background-color","#EBEBEB")});$("#colorizer").on("click","#map .nodes",function(){if(typeof $("#selected-colour").data("currentColour")!=="undefined"){var h="#"+this.id;var k=$("#colorizer").data("lockedPieces");var j=parseInt(this.id.replace("piece_","").split("-")[0]);if($.inArray(j,k)===-1){var e=$("#selected-colour").data("currentColour");var b="colour_"+e+"_colorizer";var d=$("body").data("random");$(h).attr("fill","url(#"+b+")");var i=$("#map .nodes").get();var o="";var n;var c="";var m=0;var l=i.length;var g;var b;var a;var f;for(m=0;m<l;m++){n=i[m];g="#"+n.id;f=$(g).attr("fill");b=f.replace("url(#","").replace("_colorizer)","_preview");a=b.replace("colour_","").replace("_preview","");o+='<path id="'+n.id.replace("_colorizer","_preview")+'" d="'+$(g).attr("d")+'" class="nodes" fill="'+f+'" style="stroke: #000; stroke-width: 5px;" />';c+='<pattern id="'+b+'" patternUnits="userSpaceOnUse" x="0" y="0" width="100%" height="100%"><image xlink:href="/_data/colores/rellenos/'+a+".jpg?"+d+'" x="0" y="0" width="100%" height="100%"></image></pattern>'}$(".szd-preview").loadPreview(c,o)}}else{alert(alertColours)}});$(".szd-budget-btn").click(function(){$(".modal-footer").css("display","block");$("#budget-form").css("display","block");$(".modal-body").css("height","auto");$("#budget-sent").remove();$("#plaque-preview").html($("#mosaic-left").html().replace("mosaic-left-svg","plaque-preview-svg"));var a=$("#colorizer").data("currentPlaque");var c=a.piecesList;var b=$("body").data("random");var i;var f;var k=0;var j=c.length;var d;var e=[];var h=$("#colorizer").data("lockedPieces");var g='<table class="table">';g+="<thead><tr><th>"+piecesTableName+"</th><th>"+piecesTableColour+"</th></tr></thead>";for(k=0;k<j;k++){i=c[k];f="piece_"+i.id+"-"+k;d=$("#plaque-preview #"+f).attr("fill").replace("url(#colour_","").replace("_preview)","");g+="<tr";if($.inArray(i.id,h)!==-1){g+=' class="disabled"'}g+='><td><img title="'+i.name+'" src="/_data/piezas/'+i.image+"?"+b+'" alt="'+i.name+'" width="20" height="20" class="szd-budget-pieces" /> '+i.name+"</td>";g+='<td><img title="'+d+'" src="/_data/colores/'+d+".jpg?"+b+'" alt="'+d+'" width="20" height="20" class="szd-budget-colours" /> '+d+"</td></tr>";e.push([i.name,i.image,d])}g+="</table>";$("#plaque-pieces").html(g);$("#budget-form").data("piecesList",e);$("#budget-form").loadHiddens()});$("#budget-form").on("submit",function(a){a.preventDefault();$(".modal-content").waiting("budget");$.ajax({url:$("#budget-form").attr("action"),data:new FormData(this),type:"POST",contentType:false,cache:false,processData:false,success:function(b){if(b.input!==""){$("#budget-form "+b.input).css("border","1px solid #F00");alert(b.message)}else{$("#waiting-budget").remove();$(".modal-body").prepend('<h2 id="budget-sent"><img src="/images/ok.png" width="100" height="100" /><br /><br />'+b.message+"</h2<");$("#budget-form").trigger("reset")}},error:function(){alert(fatalError)}})});$("#cookies-alert .close").click(function(){$.cookie("cookies","si",{expires:7,path:"/"});$("#cookies-alert").checkCookies()});$.fn.loadColours=function(){$.get("/admin/colores/listar",function(f){var d=f.length;var e;var c="";var b;if(d>0){var a=0;for(a=0;a<d;a++){e=f[a];b='<div class="'+e.name+" szd-colour_"+a+' szd-colour" title="'+e.name+'" data-toggle="tooltip" id="'+e.name+'"></div>';c+=b}$("#colours-palette").html(c);$("#colours-palette").data("colours",f)}else{alert(fatalError)}}).fail(function(){alert(fatalError)})};$.fn.loadPlaques=function(){$.get("/admin/placas/listar",function(f){var e=f.length;var d;var c="";var b;var g=$("body").data("random");if(e>0){var a=0;for(a=0;a<e;a++){d=f[a];b='<li class="item"';if(a==0){b+=' id="first" '}b+='><img id="'+d.id+'" title="'+plaqueLabel+" "+d.name+" ("+d.format+')" src="/_data/placas/'+d.thumbnail+"?"+g+'" alt="'+plaqueLabel+" "+d.name+'"  width="95" height="95" data-toggle="tooltip" data-placement="right" /></li>';c+=b}$("#plaques-carousel").html(c);$("#plaques-carousel").data("plaques",e)}else{alert(fatalError)}}).fail(function(){alert(fatalError)})};$.fn.loadPlaque=function(a){$.get("/admin/placas/"+a,function(c){$("#colorizer").data("currentPlaque",c);var l=0;var k;var g="";var m=0;var j="";var d="";var b;var e=$("body").data("random");var f="";var i=[];var h=$("#colours-palette").data("colours");l=h.length;for(m=0;m<l;m++){b=h[m];d+='<pattern id="colour_'+b.name+'_colorizer" patternUnits="userSpaceOnUse" x="0" y="0" width="100%" height="100%"><image xlink:href="/_data/colores/rellenos/'+b.name+".jpg?"+e+'" x="0" y="0" width="100%" height="100%"></image></pattern>'}l=c.piecesList.length;for(m=0;m<l;m++){k=c.piecesList[m];j+='<path id="piece_'+k.id+"-"+m+'" d="'+k.nodes+'" class="nodes';if(k.isLocked==1){j+=" disabled";i.push(k.id)}j+='" fill="url(#colour_'+k.colour+'_colorizer)" style="stroke: #000; stroke-width: 5px;" />';f+='<pattern id="colour_'+k.colour+'_preview" patternUnits="userSpaceOnUse" x="0" y="0" width="100%" height="100%"><image xlink:href="http://localhost:8080/_data/colores/rellenos/'+k.colour+".jpg?"+e+'" x="0" y="0" width="100%" height="100%"></image></pattern>'}$("#colorizer").data("lockedPieces",i);g='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="map" height="456" width="456" viewBox="0 0 4240 4240">';g+="<defs>";g+=d;g+="</defs>";g+=j;g+="</svg>";$("#colorizer").html(g);$(".szd-preview").loadPreview(f,j)}).fail(function(){alert(fatalError)})};$.fn.markup=function(a){$(".item img").css({"box-shadow":"none"});$("#"+a).css({"box-shadow":"0 0 5px #000"})};$.fn.waiting=function(a){if(a=="colorizer"){$("#colorizer").css("background-color","#FFF");$("#colorizer").html('<img src="/images/waiting-icon.gif" id="waiting-plaque"/>');$("#waiting-plaque").css({display:"block",margin:"auto","margin-top":"27%"})}if(a=="mosaic"){$("#mosaic-left").css("background-color","#FFF");$("#mosaic-left").html('<img src="/images/waiting-icon.gif" id="waiting-plaque-preview-left"/>');$("#mosaic-right").css("background-color","#FFF");$("#mosaic-right").html('<img src="/images/waiting-icon.gif" id="waiting-plaque-preview-right"/>');$("#waiting-plaque-preview-left").css({display:"block",margin:"auto","margin-top":"8%"});$("#waiting-plaque-preview-right").css({display:"block",margin:"auto","margin-top":"8%"})}if(a=="budget"){$(".modal-footer").css("display","none");$("#budget-form").css("display","none");$(".modal-body").css("height","50%");$(".modal-body").prepend('<img src="/images/waiting-icon.gif" id="waiting-budget"/>');$("#waiting-budget").css({display:"block",margin:"auto"})}};$.fn.loadPreview=function(d,f){var c=$("#colorizer").data("currentPlaque");var e='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" class="preview" id="mosaic-left-svg" height="237" width="237" viewBox="0 0 4240 4240">';var a=e;if($.inArray(c.id,$("#mosaic-right").data("flippedSVG"))!==-1){a='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" class="preview szd-flip-horizontal" id="mosaic-right-svg" height="237" width="237" viewBox="0 0 4240 4240">'}var b="<defs>";b+=d;b+="</defs>";b+=(""+f).replace(/_colorizer/g,"_preview");b+="</svg>";$("#mosaic-left").html(e+b);$("#mosaic-right").html(a+b)};$.fn.loadHiddens=function(){var d=$("#budget-form").data("piecesList");var c=d.length;var a=0;var b="";b+="[";for(a=0;a<c;a++){b+='{"name": "'+d[a][0]+'", "image": "'+d[a][1]+'", "colour": "'+d[a][2]+'"}, '}b+="]";$("#budget-form #pieces-list").val(b.replace("}, ]","}]"));$("#budget-form #plaque-id").val($("#colorizer").data("currentPlaque").id);svgAsPngUri(document.getElementById("plaque-preview-svg"),{scale:0.05},function(e){$("#thumbnail").val(e)})};$.fn.checkCookies=function(){if($.cookie("cookies")==="si"){$("#cookies-alert").remove()}else{$("#cookies-alert").animate({bottom:"0"},1000)}}});
